# 虚拟DOM

Angular和React的状态变化侦测有一个共同点，他们都不知道哪些状态变了。因此需要暴力对比，React是通过虚拟DOm对比，Angular是使用脏检查。Vue和上面两者不一样，它在一定程度上知道具体哪些状态发生了变化，这样就可以更细粒度的更新检查更新视图。



Vue1.0因为粒度太细，它的每一个绑定都会生成一个watcher来观察对象，这就会导致更大的内存开销以及依赖追踪的开销。

Vue2.0选择了中等粒度的解决方案，就是引入虚拟DOM。组件级别是一个Watcher实例，即一个组件里有10个节点使用了某个状态，但其实也只有一个watcher来观察这个状态变化。所以当这个状态变化时，只能通知到组件，然后组件内部通过虚拟DOM进行对比和渲染。

### patch

虚拟DOM最核心的部分就是patch，他可以将vnode渲染成真实的DOM。patch（补丁）的目的是修改DOM节点，也可以理解为渲染视图。

修改DOM无非三件事：

* 创建新增的节点
* 删除废弃的节点
* 修改需要更新的节点

**patch的运行流程**

* oldVnode是否存在
  * 不存在：使用vnode创建节点并插入视图
* oldVnode存在：oldVnode和vnode是否是同一个节点
  * 是：使用patchVnode进行更详细的对比与更新操作
* oldVnode和vnode不是同一节点：使用vnode创建真实节点并插入到视图中旧节点的旁边，并删除视图中旧节点